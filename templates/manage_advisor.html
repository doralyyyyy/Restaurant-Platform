
{% extends "base.html" %}
{% block title %}ç»è¥é¡¾é—® - {{ restaurant.name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="mb-0">ç»è¥é¡¾é—®</h3>
            <a href="{{ url_for('manage_restaurant') }}" class="btn btn-outline-secondary btn-sm">è¿”å›é¤å…æ¦‚è§ˆ</a>
        </div>
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="mb-4">
                    <h5 class="mb-3">
                        <i class="bi bi-lightbulb-fill text-warning me-2"></i>æ™ºèƒ½ç»è¥é¡¾é—®
                    </h5>
                    <p class="text-muted mb-3">
                        ä½ å¯ä»¥å‘æ™ºèƒ½é¡¾é—®è¯¢é—®å…³äºé¤å…ç»è¥çš„å„ç§é—®é¢˜ï¼Œç³»ç»Ÿä¼šç»“åˆæœ¬é¤å…çš„çœŸå®æ•°æ®è¿›è¡Œåˆ†æï¼Œä¸ºä½ æä¾›ä¸“ä¸šçš„å»ºè®®ã€‚
                    </p>
                    <div class="mb-3">
                        <small class="text-muted d-block mb-2">ğŸ’¡ å¿«é€Ÿé—®é¢˜ç¤ºä¾‹ï¼š</small>
                        <div class="d-flex flex-wrap gap-2">
                            <button type="button" class="btn btn-sm btn-outline-primary quick-question-btn" 
                                    onclick="setQuestion('å“ªä¸ªå®¢äººæ¶ˆè´¹æœ€å¤šï¼Ÿ')">
                                æ¶ˆè´¹æœ€å¤šçš„å®¢äºº
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary quick-question-btn"
                                    onclick="setQuestion('è¿‘æ¥æœ€å—æ¬¢è¿çš„ä¸‰é“èœæ˜¯å“ªäº›ï¼Ÿ')">
                                æœ€å—æ¬¢è¿çš„èœå“
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary quick-question-btn"
                                    onclick="setQuestion('æœ‰æ²¡æœ‰é¡¾å®¢å¾ˆä¹…æ²¡æ¥äº†ï¼Ÿ')">
                                æµå¤±çš„é¡¾å®¢
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary quick-question-btn"
                                    onclick="setQuestion('å“ªäº›èœå“é”€å”®é¢æœ€é«˜ï¼Ÿ')">
                                é”€å”®é¢æ’è¡Œ
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary quick-question-btn"
                                    onclick="setQuestion('æˆ‘åº”è¯¥å¦‚ä½•æå‡é¤å…çš„è¥ä¸šé¢ï¼Ÿ')">
                                æå‡è¥ä¸šé¢å»ºè®®
                            </button>
                        </div>
                    </div>
                </div>
                <form method="post" class="mb-3" id="advisorForm">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">
                            <i class="bi bi-question-circle me-1"></i>æˆ‘çš„é—®é¢˜
                        </label>
                        <textarea class="form-control" name="question" rows="4" id="questionInput"
                                  placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šå“ªä¸ªå®¢äººæ¶ˆè´¹æœ€å¤šï¼Ÿæˆ–ï¼šæˆ‘åº”è¯¥å¦‚ä½•æå‡é¤å…çš„è¥ä¸šé¢ï¼Ÿ">{{ question or '' }}</textarea>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-muted small">
                            <i class="bi bi-info-circle me-1"></i>ç³»ç»Ÿä¼šç»“åˆæœ¬é¤å…çš„çœŸå®æ•°æ®åšåˆ†æ
                        </div>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="bi bi-stars me-1"></i> è¯¢é—®é¡¾é—®
                        </button>
                    </div>
                </form>
                <div id="loadingIndicator" style="display: none;" class="mb-3">
                    <div class="d-flex align-items-center text-muted">
                        <div class="spinner-border spinner-border-sm me-2" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                        <span>AIé¡¾é—®æ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨å€™...</span>
                    </div>
                </div>
                {% if answer %}
                    <hr class="my-4">
                    <div class="d-flex align-items-center mb-3">
                        <i class="bi bi-robot text-primary me-2 fs-5"></i>
                        <h6 class="mb-0 fw-semibold">é¡¾é—®å›ç­”ï¼š</h6>
                    </div>
                    <div class="advisor-answer">
                        {{ answer|format_ai|safe }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function setQuestion(text) {
    const questionInput = document.getElementById('questionInput');
    if (questionInput) {
        questionInput.value = text;
        questionInput.focus();
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('advisorForm');
    const submitBtn = document.getElementById('submitBtn');
    const loadingIndicator = document.getElementById('loadingIndicator');
    
    if (form) {
        form.addEventListener('submit', function() {
            const questionInput = document.getElementById('questionInput');
            if (questionInput && questionInput.value.trim()) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>æäº¤ä¸­...';
                loadingIndicator.style.display = 'block';
            }
        });
    }
});
</script>
{% endblock %}
